<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/favicon.ico" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
        integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">
    <link rel="stylesheet" href="/styles/main.css">
    <script src="/scripts/app.js" defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <title>Bad Apple</title>
</head>

<body>

    <nav class="navbar" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <i class="fas fa-apple-alt fa-2x"></i>
            </a>

            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false"
                data-target="navbarBasicExample">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>

        <div id="navbarBasicExample" class="navbar-menu">
            <div class="navbar-start">
                <div class="level-item">
                    <div class="field has-addons">
                        <p class="control">
                            <input class="input" type="text" placeholder="Find a movie">
                        </p>
                        <p class="control">
                            <button class="button" id="search-btn">
                                Search
                            </button>
                        </p>
                    </div>
                </div>
            </div>

            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="buttons">
                        <a class="button is-primary" id="reg-btn">
                            <strong>Sign up</strong>
                        </a>
                        <a class="button is-light" id="log-btn">
                            Log in
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

        <!-- movie information section -->
    <section>
        <div class="columns is-mobile is-multiline is-vcentered" id="cards-container">
            <div class="columns">
                    <div class="column is-half">
                        <div class="box">
                            <img src="<%= movie.image %>" alt="<%= movie.title %>">
                        </div>
                    </div> 
                    <div class="column is-half" id="movie-info">
                        <div class="content">
                            <ul>
                                <li> <h2 id="title"> <%=movie.title %> </h2> </li>
                                <li id="description"> <%= movie.description %> </li>
                                <li> <strong>Runtime:</strong> <%= movie.runtime %> </li>
                                <li> <strong>Genre:</strong> <%= movie.genre %> </li>
                                <li> <strong>Cast:</strong> <%= movie.cast %> </li>
                            </ul>
                        </div>

                        <!-- create review button and modal -->
                        <div class="buttons">
                            <a class="button is-primary modal-btn" id="create-btn">
                                <strong>Submit Review</strong>
                            </a>
                            <div class="modal" id="create-modal">
                                <div class="modal-background" id="create-modal-background"></div>
                                <div class="modal-content">
                                    <div class="box modal-box">
                                        <form action="/reviews/<%= movie.id %>" method="POST">
                                            <div class="field">
                                                <label class="label"> Rating </label>
                                                <input 
                                                    class="input"
                                                    type="number"
                                                    name="rating"
                                                    min="1"
                                                    max="5"
                                                    placeholder="1-5"
                                                />
                                            </div>
                                            <div class="field">
                                                <label class="label">Content</label>
                                                <textarea
                                                    name="content"
                                                    class="textarea"
                                                    placeholder="Leave a review for <%= movie.title %>!"
                                                ></textarea>
                                            </div>
                                            <input type="hidden" name="movie" value="<%= movie._id%>">
                                            <button class="button mt-4">Submit</button>
                                        </form>
                                        <button class="modal-close is-large" id="create-close" 
                                        aria-label="close">
                                        </button>
                                    </div>
                                </div>
                            </div>
                        
                        </div>
                    </div>
            </div>
        </div>
    </section>

        <!-- post reviews -->
    <section class="column">
        <div class="column">
            <% reviews.forEach(review => { %>
            <div class="box" id="review-box">
            <article class="media">
                <div class="media-left">
                <figure class="image is-64x64">
                    <!-- <img src="" alt="User Avatar" /> -->
                </figure>
                </div>

                <div class="media-content">
                <div class="content">
                   <!--- <h3> </h3> -->
                    <small>
                    <%= new Date(review.createdAt).toLocaleString() %>
                    </small>

                    <br/>
                  
                    <% for( let index = 0; index < 5; index++ ) { %> 
                    <% if (review.rating > index) { %>
                    <span class="icon" style="color: rgb(228, 228, 15)">
                    <i class="fas fa-star"></i>
                    </span>
                    <% } else { %>
                    <span class="icon">
                    <i class="fas fa-star"></i>
                    </span>
                    <% } %> 
                    <% } %>

                    <br />
                    <%= review.content %>
                    <hr/>
    
                </div>
                </div>
                   
                <div class="media-right">
                    <section class="navbar-item has-dropdown is-hoverable">
                    <a class="navbar-link"></a>
                    <div class="navbar-dropdown">

                        

                          <!-- Edit Modal -->
                
                          <%- include('../partials/edit', { review:  review, movieId: movie.id }) %>

                    <hr class="navbar-divider" />
                        <div>
                            <form action="/reviews/<%= movie.id %>/<%=review.id %>?_method=DELETE" method="POST">
                                <input class="button is-danger m-2 is-dark" type="submit" value="Remove"/>
                                <input type="hidden" name="movie" value="<%= movie.id%>">
                            </form>
                        </div>
                    </div>
                    </section>
                </div>
            </article>
            </div>
            <% }) %>
        </div>
    </section>

    <footer class="footer" id="footer">
        <div class="content has-text-centered">
            <p><i class="fas fa-apple-alt"></i> <strong>Bad Apple</strong> by Jenna Waffensmith & Dan Bae</p>
            <hr>
        </div>
        <div class="content has-text-centered">
            <ul>
                <li>About Us</li>
                <li>Careers</li>
                <li>Contact Us</li>
            </ul>
        </div>
    </footer>

</body>
</html>